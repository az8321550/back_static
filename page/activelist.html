<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>数字营销平台</title><link rel="shortcut icon" href="../static/images/favicon.ico">
    <link href="../static/plugins/bootstrap/css/bootstrap.css" rel="stylesheet" />
    <link href="../static/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="../static/plugins/jquery-jqgrid/ui.jqgrid.css" rel="stylesheet" />
    <link href="../static/styles/base.css" rel="stylesheet" />
    <link href="../static/styles/setting.css" rel="stylesheet" />
    
</head>
<body>
    <div class="sider">
        <div class="home-menu">
            <a href="index.html">
                <i class="icon icon-home"></i>
            </a>
        </div>
        <div class="main-name">
            数字营销平台
        </div>
        <div class="user clearfix">
            <img src="../static/images/header.png" />
            Admin_Super
        </div>
        <ul class="menu">
            <li><a href="list.html">营销活动</a></li>
            <li><a href="backlist.html">不过滤活动</a></li>
            <li class="active"><a href="activelist.html">活动任务</a></li>
            <li><a href="typelist.html">业务类型</a></li>
        </ul>
        <ul class="menu set-menu">
            <li><a href="taglist.html">会员中心</a></li>
            <li><a href="waylist.html">渠道中心</a></li>
            <li><a href="tmplactive.html">模板中心</a></li>
        </ul>
    </div>
    <div class="content">
        <div class="clearfix">
            <div class="col-xs-12">
                <div id="list-top">
                    <div class="breadcrumb-con">
                        <ol class="breadcrumb">
                            <li><a href="index.html"><i class="icon icon-home"></i></a></li>
                            <li><a href="#">常规业务</a></li>
                            <li class="active">活动任务</li>
                        </ol>
                        <div class="search-con">
                            <form>
                                <input class="text" type="text" placeholder="快速检索" />
                                <button class="button"><i class="icon icon-search"></i></button>
                            </form>
                        </div>
                    </div>
                    <div class="content-title clearfix mb20">
                        <span class="title fontblue">活动任务</span>
                        <div class="group-small clearfix">
                            <a href="#" class="btn btn-default btn-sm">导出</a>
                            <a href="#" class="btn btn-default btn-sm" id="create-cancel">取消</a>
                            <a class="btn btn-default btn-sm" data-toggle="examine" id="view-look" data-href="#" data-msg="查看过滤">查看过滤</a>
                            <a href="#" class="btn btn-default btn-sm">重发</a>
                        </div>
                        <div class="filter">
                            <a href="#" data-toggle="dialog" data-target="#main-dialog" class="btn btn-default btn-sm">筛 选 <b class="caret"></b></a>
                        </div>
                    </div>
                </div>
                <table id="data" class="ui-jqgrid"></table>
                <div id="pager"></div>
            </div>
        </div>

    </div>
    <div class="modal fade" id="myModal" tabindex="-1" data-backdrop="static" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width:1240px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">查看过滤信息</h4>
                </div>
                <div class="modal-body">
                    <table id="filterTable" class="table table-bordered table-striped table-hover">
                        <tr>
                            <th width="89">被过滤原因</th>
                            <th width="74">目标名称</th>
                            <th width="89">目标批次号</th>
                            <th width="89">目标优先级</th>
                            <th width="46">名称</th>
                            <th width="60">批次号</th>
                            <th width="61">优先级</th>
                            <th width="104">被过滤总个数</th>
                            <th width="105">被过滤总详情</th>
                        </tr>
                    </table>
                    <div class="clearfix" id="filterPage">
                        <!--<ul class="pagination pull-right nomargin">
                            <li><a href="#">&laquo;</a></li>
                            <li class="active"><a href="#">1</a></li>
                            <li><a href="#">2</a></li>
                            <li><a href="#">3</a></li>
                            <li><a href="#">4</a></li>
                            <li><a href="#">5</a></li>
                            <li><a href="#">&raquo;</a></li>
                        </ul>-->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary">保存</button>
                </div>
            </div>
        </div>
    </div>
    <div class="main-dialog" id="main-dialog">
        <div class="event-manage">
            <div class="col-xs-12">
                <div class="event-top clearfix">
                    <div class="event-icon">
                        <i class="icon icon-reorder"></i>
                    </div>
                    <div class="title">
                        筛选条件
                    </div>
                </div>
                <form class="form-horizontal pt20" id="main-form">
                    <div class="form-group">
                        <label class="control-label col-md-2">批次号：</label>
                        <div class="col-md-10">
                            <input type="text" class="form-control" id="taskId" name="taskId">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2">任务名称：</label>
                        <div class="col-md-10">
                            <input type="text" class="form-control" id="taskName" name="taskName">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2">状态：</label>
                        <div class="col-md-10">
                            <select class="form-control select2" id="taskStatus" name="taskStatus">
                                <option value=""></option>
                                <option value="1">等待中</option>
                                <option value="3">排队中</option>
                                <option value="4">发送中</option>
                                <option value="5">发送成功</option>
                                <option value="6">发送失败</option>
                                <option value="8">已取消</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2">活动类型：</label>
                        <div class="col-md-10">
                            <select class="form-control select2" id="actType" name="actType">
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2">渠道：</label>
                        <div class="col-md-10">
                            <select class="form-control select2" id="channel" name="channel">
                                <option value=""></option>
                                <option value="1">短信</option>
                                <option value="2">邮件</option>
                                <option value="3">Push</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-offset-1 col-md-11 mybtn pt20">
                            <div class="pull-right">
                                <button class="btn btn-success" type="button" onclick="search();">筛选</button>
                                <button class="btn btn-default" type="button" data-toggle="dialog-close">取消</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="../static/plugins/jquery/jquery.js"></script>
    <script src="../static/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="../static/plugins/bootstrap-bootbox/bootbox.js"></script>
    <script src="../static/plugins/jquery-mockjax/jquery.mockjax.js"></script>
    <script src="../static/plugins/jquery-jqgrid/jquery.jqGrid.js"></script>
    
    
    <script src="../static/plugins/bootstrap-paginator/bootstrap-paginator.js"></script>
    <script src="../static/scripts/app.js"></script><!--[if lt IE 9]>
    <script src="../static/plugins/respond/respond.min.js"></script>
    <script src="../static/plugins/html5shiv/html5shiv.min.js"></script><![endif]-->
    <script>
        !function () {

            //模拟ajax
            $.mockjax({
                url: "test.php",
                type: "post",
                responseTime: 0,
                responseText: JSON.stringify({ "page": 1, "totalPage": 12, "totalCount": 888, "rows": [{ "id": 1000, "cell": ["1700", "b79a2539ca9b4d388d5c020e7c7f0107", "qin市场活动", "已结束", "0", "2014-03-21 15:45:00", "营销活动", "营销短信网关", "0", "一共0条数据被过滤", "状态:成功,服务器:zhaoqin-PC,耗时:4ms", "2014-03-21 17:00:21"] }, { "id": 1, "cell": ["1700", "b79a2539ca9b4d388d5c020e7c7f0107", "qin市场活动", "已结束", "0", "2014-03-21 15:45:00", "营销活动", "营销短信网关", "0", "一共0条数据被过滤", "状态:成功,服务器:zhaoqin-PC,耗时:4ms", "2014-03-21 17:00:21"] }, { "id": 2, "cell": ["1700", "b79a2539ca9b4d388d5c020e7c7f0107", "qin市场活动", "已结束", "0", "2014-03-21 15:45:00", "营销活动", "营销短信网关", "0", "一共0条数据被过滤", "状态:成功,服务器:zhaoqin-PC,耗时:4ms", "2014-03-21 17:00:21"] }, { "id": 3, "cell": ["1700", "b79a2539ca9b4d388d5c020e7c7f0107", "qin市场活动", "已结束", "0", "2014-03-21 15:45:00", "营销活动", "营销短信网关", "0", "一共0条数据被过滤", "状态:成功,服务器:zhaoqin-PC,耗时:4ms", "2014-03-21 17:00:21"] }, { "id": 4, "cell": ["1700", "b79a2539ca9b4d388d5c020e7c7f0107", "qin市场活动", "已结束", "0", "2014-03-21 15:45:00", "营销活动", "营销短信网关", "0", "一共0条数据被过滤", "状态:成功,服务器:zhaoqin-PC,耗时:4ms", "2014-03-21 17:00:21"] }, { "id": 5, "cell": ["1700", "b79a2539ca9b4d388d5c020e7c7f0107", "qin市场活动", "已结束", "0", "2014-03-21 15:45:00", "营销活动", "营销短信网关", "0", "一共0条数据被过滤", "状态:成功,服务器:zhaoqin-PC,耗时:4ms", "2014-03-21 17:00:21"] }, { "id": 6, "cell": ["1700", "b79a2539ca9b4d388d5c020e7c7f0107", "qin市场活动", "已结束", "0", "2014-03-21 15:45:00", "营销活动", "营销短信网关", "0", "一共0条数据被过滤", "状态:成功,服务器:zhaoqin-PC,耗时:4ms", "2014-03-21 17:00:21"] }] })
            });
            $.mockjax({
                url: "test2.php",
                type: "post",
                responseTime: 0,
                responseText: JSON.stringify({ "page": 18, "totalPage": 88, "totalCount": 888, "rows": [{ "name": "小于目标等级", "name2": "_push_one", "name3": "_push_one", "name4": "0", "name5": "7天内只发2条", "name6": "1fakjiod", "name7": "0", "name8": "2", "name9": "一共2条被过滤" }, { "name": "小于目标等级", "name2": "_push_one", "name3": "_push_one", "name4": "0", "name5": "7天内只发2条", "name6": "1fakjiod", "name7": "0", "name8": "2", "name9": "一共2条被过滤" }, { "name": "小于目标等级", "name2": "_push_one", "name3": "_push_one", "name4": "0", "name5": "7天内只发2条", "name6": "1fakjiod", "name7": "0", "name8": "2", "name9": "一共2条被过滤" }, { "name": "小于目标等级", "name2": "_push_one", "name3": "_push_one", "name4": "0", "name5": "7天内只发2条", "name6": "1fakjiod", "name7": "0", "name8": "2", "name9": "一共2条被过滤" }, { "name": "小于目标等级", "name2": "_push_one", "name3": "_push_one", "name4": "0", "name5": "7天内只发2条", "name6": "1fakjiod", "name7": "0", "name8": "2", "name9": "一共2条被过滤" }] })
            });

            //jqGrid配置
            $("#data").jqGrid({
                url: 'test.php',
                colNames: ['活动ID', '批次号', '任务名称', '状态', '发送数', '执行时间', '类型', '渠道', '过滤数', '过滤详情', '执行情况', '创建时间'],
                colModel: [
                    { name: "id", sortable: true, width: "80", formatter: formatId },
                    { width: "300" },
                    { width: "100" },
                    { width: "100" },
                    { width: "100" },
                    { width: "200" },
                    { width: "100" },
                    { width: "200" },
                    { width: "100" },
                    { width: "200" },
                    { width: "300" },
                    { width: "200" }
                ],
                autowidth: false,
                ondblClickRow: function (rowid) {
                    //双击跳活动明细
                    location.href = "activedetail.html?id=" + rowid;
                }
            });

            function formatId(cellvalue, options, rowObject) {
                return "<a href='#'>" + cellvalue + "</a>"
            }

            $("#view-look").bind("myclick", function () {
                $("#myModal").modal("toggle");
                $.post("test2.php", function (data) {
                    postFilter(data);
                });
            });

            var postFilter = function (data) {
                data = $.parseJSON(data);
                var tempArr = [];
                for (var i = 0; i < data.rows.length; i++) {
                    tempArr.push('<tr>');
                    for (var item in data.rows[i]) {
                        tempArr.push('<td title=' + data.rows[i][item] + '>' + data.rows[i][item] + '</td>');
                    }
                    tempArr.push('</tr>');
                }
                $("#filterTable").find("tr").not(":first").remove();
                $("#filterTable").append(tempArr.join(""));

                $('#filterPage').bootstrapPaginator({
                    currentPage: data.page,
                    totalPages: data.totalPage,
                    onPageClicked: function (e, originalEvent, type, page) {
                        $.post("test2.php", {page:page}, function (data) {
                            postFilter(data);
                        });
                    }
                });
            }

        }();
    </script>
</body>
</html>
