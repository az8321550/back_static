var app={init:function(){var n=$(window).height()>$("html").height()?$(window).height():$("html").height();$(".sider").height(n)},menuInit:function(){$(function(){if($(".breadcrumb").length)$(document).on("click",".breadcrumb .icon-home",function(){return localStorage.removeItem("url"),parent.window.location.href="/dmp/index",!1})})}(),animate:function(){$(".content").css({"margin-left":"-150px"}).animate({margin:"0"})},dialog:function(){$(document).on("click",'[data-toggle="dialog"]',function(){return app.showDialog($(this).data("target"),$(this).data("title")),!1})}(),ajaxLoading:function(){$(document).ajaxError(function(){bootbox.alert("系统运行错误，如果您在使用本系统，多次出现此错误，请与管理员联系。")}).ajaxStart(function(){$("#loading").length||$("body").append('<div id="loading"><i class="icon-spinner icon-spin"><\/i><\/div>')}).ajaxStop(function(){$("#loading").remove()})}(),quickSearch:function(){$(function(){var n=$(".search-con");if(n.length){n.children().get(0).onsubmit=function(){return n.find("button").trigger("click"),!1};n.find("button").click(function(){var n=$(this).prev().val();return $(".quick-search").each(function(n,t){var i=$(t).text();$(t).parent().html(function(){return $(this).html().replace(/<em class="quick-search">(.*)<\/em>/,i)})}),n!=""&&($("*:contains("+n+")").each(function(t,i){var i=$(i),u=i.get(0).tagName,r;if(u=="OPTION"||u=="SCRIPT"||i.children().length>3)return!0;r=i.clone().children().remove().end().text();r.indexOf(n)!=-1&&i.html(function(){var t=r.replace(n,"<em class='quick-search'>"+n+"<\/em>");return i.html().replace(r.trim(),t)})}),$(".quick-search").length&&$("body,html").animate({scrollTop:$(".quick-search").first().offset().top-$(window).height()+200},1)),!1});n.find("input").on("keyup",function(){var n=$(this).val();n==""&&$(".quick-search").each(function(n,t){var i=$(t).text();$(t).parent().html(function(){return $(this).html().replace(/<em class="quick-search">(.*)<\/em>/,i)})})})}})}(),getScrollbarWidth:function(){var n=document.createElement("div"),t;return n.className="modal-scrollbar-measure",$(document.body).append(n),t=n.offsetWidth-n.clientWidth,$(document.body)[0].removeChild(n),t},showDialog:function(n,t){var i,n;document.body.clientWidth<window.innerWidth&&(i=app.getScrollbarWidth(),$("body").css("padding-right",i));n=$(n);n.show();t&&n.find(".title").text(t);setTimeout(function(){n.find(".event-manage").addClass("dialog-open")},100);$("body").addClass("modal-open");n.trigger("dialog.show");n.unbind("click").on("click",function(t){t.target.id==n.attr("id")&&app.dialogHide(n)}).find('.btn[data-toggle="dialog-close"]').on("click",function(){n.find("form").length&&n.find("form").get(0).reset();n.find(".select2-offscreen").length&&n.find(".select2-offscreen").select2("val","");n.find("input[type='hidden']").val("")});$("body").on("keydown",function(t){t.keyCode==27&&app.dialogHide(n)});return!1},dialogHide:function(n){n=$(n);n.find(".event-manage").removeClass("dialog-open");$("body").unbind("keydown");app.resetForm(n);setTimeout(function(){$("body").css({"padding-right":0}).removeClass("modal-open");n.hide();n.trigger("dialog.hide")},300)},con:function(){$(document).on("click",'[data-toggle="con"]',function(){return app.showcon($(this).data("target")),$(this).blur(),!1})}(),showcon:function(n){var n=$(n);n.trigger("con.show").find(".movecontent").show().animate({opacity:"1"},200);setTimeout(function(){$("body").click(function(t){$(".movecontent").find($(t.target)).length||$(t.target).hasClass("movecontent")||app.hidecon(n)})},100)},hidecon:function(n){n.trigger("con.hide").find(".movecontent").hide().css("opacity",0);$("body").unbind("click")},examine:function(){$(document).on("click",'[data-toggle="examine"]',function(){var i=$("#data").jqGrid("getGridParam","selarrrow"),t="审核",n=$(this);return(n.data("msg")&&(t=$(this).data("msg")),!n.data("multi")&&i.length>1)?(bootbox.alert(t+"不能多选"),!1):i.length==0?(bootbox.alert("请选择需要"+t+"的数据"),!1):(n.data("href")&&(location.href=n.data("href")),n.trigger("myclick"),!1)})}(),showValidate:function(n,t){var n=$("#"+n);n.next(".help-block").length?n.next(".help-block").text(t).show().parent().parent().removeClass("has-success").addClass("has-error"):n.after("<span class='help-block'>"+t+"<\/span>").parent().parent().removeClass("has-success").addClass("has-error")},validateJson:function(n){if(n.responseResult){if(typeof n.responseResult.error!="undefined")for(var t=0;t<n.responseResult.error.length;t++)app.showValidate(n.responseResult.error[t].element,n.responseResult.error[t].msg)}else n.msg&&(bootbox.alert(n.msg),app.resetForm($(".dialog-open")),app.dialogHide($(".main-dialog")))},dropdown:function(){$(function(){$(".dropdown").each(function(n,t){var i=$(t);i.on("click","li",function(){return i.removeClass("open"),i.find("a[data-toggle=dropdown]").html($(this).find("a").text()+' <b class="caret"><\/b>'),!1})})})}(),resetForm:function(n){n.find(".title:contains(筛选)").length||n.find(".form-group").length&&(n.find(".form-group").removeClass("has-error").removeClass("has-success").end().find(".help-block").remove(),n.find("form").length&&n.find("form").get(0).reset(),n.find(".select2-offscreen").length&&n.find(".select2-offscreen").select2("val",""),n.find("input[type='hidden']").val(""))},data:function(){Date.prototype.format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length==1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n}}()},gridFlag=gridFlag2=!1;